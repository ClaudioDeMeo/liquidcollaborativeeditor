<!--
@license
-->

<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/juicy-ace-editor/juicy-ace-editor.html">

<dom-module id="code-editor">
  <template>
    <style include="shared-styles">
      juicy-ace-editor {
        width: 100%;
        height: 100%;
      }
    </style>
    <!-- CODE-EDITOR DEFINE -->
    <juicy-ace-editor id="textEditor"
      theme="ace/theme/monokai"
      mode="ace/mode/html"
      fontsize=15
      on-keypress="send"
      ></juicy-ace-editor>
  </template>

  <script>
    Polymer({
      is:'code-editor',
      behaviors: [
      ],
      properties: {
        datachannel: {
          type: Object,
          value: {
            data:null,
            ondata:null,
          },
          notify: true,
        },
      },

      log: console.log,

      ready: function() {
        var self=this;
        self.datachannel.ondata=function(data){
          self.log('ondata', data);
          data=JSON.parse(data);
          self.$.textEditor.editor.insert(data.text);
        };
      },

      send: function(e){
        var self=this;
        var message={
          text: e.key,
        }
        if (self.datachannel.data){
          self.datachannel.data({
            text: JSON.stringify(message),
            success: function(){
            },
            error: function(reason) {
              self.log(reason);
            }
          });
        }
      },

    });
  </script>
</dom-module>
